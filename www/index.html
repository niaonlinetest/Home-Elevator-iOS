<!DOCTYPE html>
<html>
  <head>
    <title>
    </title>
     <link type="text/css" href="css/style.css" rel="stylesheet" />

    <script src="jquery.min.js">
    </script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
   <!-- 
    <script type="text/javascript"  charset="utf-8" src="ExtractZip.js"></script>  
    <script type="text/javascript"  charset="utf-8" src="js/require.js"></script>
    <script type="text/javascript"  charset="utf-8" src="js/myzip.js"></script>-->
     <script type="text/javascript"  charset="utf-8" src="js/usage.js"></script>
    <script type="text/javascript"  charset="utf-8" src="js/ZipPlugin.js"></script> 
 
    <script type="text/javascript">

    var myPath;

      function getPhoneGapPath() {

    var path = window.location.pathname;
    path = path.substr( 0, path.length - 10 );
    return 'file://' + path;

};


var resource = getPhoneGapPath()+ "assets";


     function onBodyLoad() {



  document.addEventListener("deviceready", onDeviceReady, false);
       
  //window.zip = cordova.require('cordova.plugin.ExtractZip.ExtractZip');
  // create dir------ ------------------------------------------------------

  window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRequestFileSystemSuccess, null);

  function onRequestFileSystemSuccess(fileSystem) {
    var entry = fileSystem.root;

        // index link--------------
    console.log(entry.fullPath + "/example/site/index.html");
    var mySiteUrl = entry.fullPath + "/example/site/index.html"
    var mySiteUrl2 = entry.fullPath + "/example/site/phone-call-active-128.png"
    var divOpen = document.getElementById("open");
    var divOpen2 = document.getElementById("open2");
    divOpen.setAttribute("src", mySiteUrl);
    divOpen2.setAttribute("src", mySiteUrl2);
    console.log(entry.fullPath + "/example/site/index.html");
    console.log("uper hai url");


    entry.getDirectory("example", {
      create: true,
      exclusive: false
    }, onGetDirectorySuccess, onGetDirectoryFail);
   

  }

  function onGetDirectorySuccess(dir) {
  console.log("Created dir " + dir.name);
  }

  function onGetDirectoryFail(error) {
    console.log("Error creating directory " + error.code);
  }
  //end dir -------------------------------------
 }
// downloading files-------------------------------------------
 function downloadFile() {
  window.requestFileSystem(
  LocalFileSystem.PERSISTENT, 0, function onFileSystemSuccess(fileSystem) {
    fileSystem.root.getFile("dummy.html", {
      create: true,
      exclusive: false
    }, function gotFileEntry(fileEntry) {
      var sPath = fileEntry.fullPath.replace("dummy.html", "");
      var fileTransfer = new FileTransfer();
      fileEntry.remove();
       // alert("dowdnload" +resource);
       // alert(sPath);
        console.log("dowdnload" +resource);
        console.log("SPATH<><><>"+ sPath);
        myPath = sPath ;

        console.log("myPath"+ myPath);

       // fileTransfer.download("http://bluesapphirecreations.info/design/d1/he-app/site.zip", resource+"/site.zip",
      fileTransfer.download("http://bluesapphirecreations.info/design/d1/he-app/site.zip", sPath + "example/" + "site.zip",
      // fileTransfer.download("https://www.google.co.in/images/srpr/logo11w.png", sPath + "example/" + "logo.zip",

      function(theFile) {
        showLink(theFile.toURL());
        
        
      }, function(error) {
        console.log("download error source " + error.source);
        console.log("download error target " + error.target);
        console.log("upload error code: " + error.code);
      } //,
        // console.log('start extracting now vip');
        // extractFile(sPath + "/example/" + "site.zip");
        // console.log('end extracting now vip');
      );
    }, fail);
  }, fail);

 } 
//downloading end------------------------------
 function showLink(url) {

  //alert(url);
  //$("#open").show();

  
  console.log(url + " ab check kro");
  //extractFile(url);
  
  // start extracting zip
                
   
        console.log('start extracting now zip'); 
        //     try{
        //           document.addEventListener('deviceready', onDeviceReady);
        //           document.body.style.background = 'red';
        //           window.zip = cordova.require('cordova.plugin.ExtractZip.ExtractZip');
        //     }catch(error){
        //       alert(error);
        //     }
         

        
        //  function extractZip(fileName) {

        //   alert(fileName);

        //     zip.extract(site.zip, '/var/mobile/Applications/39BFC918-E086-4FEF-9AE4-A1009CD477D9/Documents/example/', win, fail);
        // }
        //  function getTempDir(dirName) {
        //     zip.getTempDir(url, win, fail);
        // }
        // function win(status) {
        //     alert('Message: ' + status);
        // }
        // function fail(status) {
        //     alert('Error: ' + status);
        // }

var fileName = myPath+"example/site.zip";
       var destination = resource;

     console.log("fileName"+ fileName);  
//     try{ 
//       alert(1);
//     var AdmZip = require('adm-zip');
//     alert(AdmZip);
//       // reading archives
//     var zip = new AdmZip(fileName);
//      alert(zip);
//     var zipEntries = zip.getEntries(); // an array of ZipEntry records

//     zipEntries.forEach(function(zipEntry) {
//         console.log(zipEntry.toString()); // outputs zip entries information
//         if (zipEntry.entryName == "index.html") {
//              console.log(zipEntry.data.toString('utf8')); 
//         }
//     });
    
//     // extracts the specified file to the specified location
//    alert("Deepak Singh");
//    try{
//     alert("INSIDE TRY");
//       // extracts everything
//     zip.extractAllTo(destination, /*overwrite*/true);
//     alert("After TRY");

//    }catch(error){
//       alert(error);
//    }

//     }catch(error){
//       console.log("Error is<><><>" + error);
//       alert("Error is<><><>" + error);
//     }
    
    
     //  function extractFile(fileurl)
      //   function extractFile(fileName, destination) {
      // try{
           
      // var ZipClient = new ExtractZipFilePlugin();
      // //ZipClient.extractFile(fileurl,win,fails);
      // ZipClient.extractFile(fileurl+destination,win,fail);
      

      //       }
      //       catch(error){
      //         alert(error);
      //       }
      // console.log("file url is . "+fileurl);
      // return ; 
      // }
      // function win(status) 
      // { 
      // alert('Success in unzip'+status);
      // return;
      // } 
      
      // function fails(error) 
      // { alert(error+"is error");
      // }


      //  //console.log(sPath + "example/" + "site.zip");

      //     extractFile(fileName);
        //ExtractZip( "/var/mobile/Applications/39BFC918-E086-4FEF-9AE4-A1009CD477D9/Documents/example/" + "site.zip");



        try{

            function extractFile(fileurl) { 
              console.log("file url is . "+fileurl);
            var ZipClient = new ExtractZipFilePlugin();
              console.log("Zip Client<><>" + ZipClient);
            ZipClient.extractFile(fileurl,win,fails);
              alert("Deepak Singh");
            return ;
            }
            function win(status) 
            { 
            alert('Success in unzip'+status);
            return;
            } 

            function fails(error) 
            { alert(error+"is error");
            }

        }catch(err){
          alert(err);
        }

        try{
        extractFile(fileName)
        }catch(err){
          alert("My Error<><>"+err);
        }

        console.log('deepak print');
        // try{

        // }catch(err){
        //   alert("Error<><><> " + err);
        // }
        console.log('end extracting now vip, my func is fine ');
       // extractFile('example/site.zip');
       // extractZip('example/site.zip');

 }


 function fail(evt) {
  console.log(evt.target.error.code);
 }

 

 function onDeviceReady() {
  // do your thing!
  downloadFile();


 }
    </script>
  </head>
  <body >

<div class="wrap">
<h1>Home Elevator</h1>
<div class="letest">
<span> Refresh for latest version</span><a class="button" onclick="onBodyLoad()"  href="#">Refresh</a>
</div>
<div class="browse">
<a href="#">Browse Now</a>
</div>
<div class="start">
<a class="startbtn" href="example/site/index.html">Start</a>
<br><br>
<a class="startbtn" href="file://localhost/var/mobile/Applications/61D9D333-99EA-44F6-81E1-E5645C2D90FA/Documents/example/site/index.html">Start2</a> 
</div>
</div>

<br><br>
<img src="/img/bsc.jpg" alt="">



<img src="/example/logo.jpg" alt="">
<img src="/var/mobile/Applications/39BFC918-E086-4FEF-9AE4-A1009CD477D9/Documents/example/site/logo.jpg" alt="">
<img src="/var/mobile/Applications/39BFC918-E086-4FEF-9AE4-A1009CD477D9/Documents/example/site/logo.jpg" alt="">
<iframe src="http://google.com" width="400" height="400"  frameborder="0"></iframe>

<br><br>
frame 2
<br><br>
<img src="/var/mobile/Applications/39BFC918-E086-4FEF-9AE4-A1009CD477D9/Documents/example/site/phone-call-active-128.png" id="open2" alt="">
<iframe src="" id="open" width="400" height="400" frameborder="0"></iframe>
     <!--  <span id="ready">
      </span>
      <a href="#" id="open" style="display: none;">open</a>
      <image src="" id="open2" style="display: none;" alt="" /> -->
    

  </body> 
  </html>